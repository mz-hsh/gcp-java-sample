<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Google Cloud Sample App</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
</head>

<body>
	<div id="app" class="container">
		<div class="row">
			<input type="text" v-model="post.title" placeholder="Title">
			<input type="text" v-model="post.content" placeholder="Content">
			<input type="file">
			<button type="button" class="btn" @click="save">등록</button>
		</div>
		<div class="row">
			<table class="highlight">
				<thead>
					<tr>
						<th scope="col">#</th>
						<th scope="col">Title</th>
						<th scope="col">Content</th>
						<th scope="col">File</th>
					</tr>
				</thead>
				<tbody>
					<tr v-for="post of posts" :key="post.id">
						<td>{{ post.id }}</td>
						<td>{{ post.title }}</td>
						<td>{{ post.content }}</td>
						<td>{{ post.originalFilename }}</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script src="https://unpkg.com/vue"></script>
	<script>
		new Vue({
			el: '#app',
			data: {
				post: {
					title: '',
					content: '',
				},
				posts: []
			},
			methods: {
				async save() {
					let formData = new FormData();
					formData.append('file', document.querySelector('#app input[type="file"]').files[0])
					formData.append('title', this.post.title)
					formData.append('content', this.post.content)

					try {
						await axios.post('/posts', formData)
						this.fetchPosts()
					} catch (e) {
						alert(e)
					}
				},
				fetchPosts() {
					axios.get('/posts').then(({ data }) => {
						this.posts = data
					})
				}
			},
			created() {
				this.fetchPosts()
			}
		})
	</script>
</body>

</html>